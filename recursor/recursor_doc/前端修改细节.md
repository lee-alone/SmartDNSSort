# Recursor å‰ç«¯é›†æˆæ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨ SmartDNSSort Web UI ä¸­é›†æˆ Recursorï¼ˆåµŒå…¥å¼ Unbound é€’å½’è§£æå™¨ï¼‰çš„é…ç½®å’ŒçŠ¶æ€æ˜¾ç¤ºåŠŸèƒ½ã€‚

---

## 1ï¸âƒ£ é…ç½®é¡¹éœ€æ±‚

### 1.1 é…ç½®ç»“æ„

åœ¨ `config/config_types.go` ä¸­çš„ `UpstreamConfig` æ·»åŠ ï¼š

```go
type UpstreamConfig struct {
    // ... ç°æœ‰å­—æ®µ ...
    
    // Recursor é…ç½®
    EnableRecursor bool `yaml:"enable_recursor,omitempty" json:"enable_recursor"`
    RecursorPort   int  `yaml:"recursor_port,omitempty" json:"recursor_port"`
}
```

### 1.2 é…ç½®é»˜è®¤å€¼

åœ¨ `config/config_defaults.go` ä¸­æ·»åŠ ï¼š

```go
// Recursor é»˜è®¤é…ç½®
if cfg.Upstream.RecursorPort == 0 {
    cfg.Upstream.RecursorPort = 5353  // é»˜è®¤ç«¯å£
}
```

---

## 2ï¸âƒ£ å‰ç«¯ UI ä¿®æ”¹

### 2.1 æ–°å¢é…ç½®ç»„ä»¶

**æ–‡ä»¶ï¼š** `webapi/web/components/config-recursor.html`

```html
<section class="bg-card-light dark:bg-card-dark rounded-xl shadow-sm border border-border-light dark:border-border-dark overflow-hidden">
    <div class="px-6 py-5 border-b border-border-light dark:border-border-dark">
        <h2 class="text-xl font-bold" data-i18n="config.recursor.legend">Recursive Resolver</h2>
    </div>
    <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
        
        <!-- å¯ç”¨/ç¦ç”¨å¼€å…³ -->
        <div class="form-group md:col-span-2">
            <label class="flex items-center gap-3">
                <input type="checkbox" 
                       id="upstream.enable_recursor" 
                       name="upstream.enable_recursor"
                       class="h-5 w-5 rounded text-primary focus:ring-primary">
                <span data-i18n="config.recursor.enable">Enable Embedded Unbound Recursor</span>
            </label>
            <small data-i18n="config.recursor.enableHelp">
                Provides recursive DNS resolution capability. Requires Unbound 1.24.2 binary.
            </small>
        </div>

        <!-- ç«¯å£é…ç½® -->
        <div class="form-group">
            <label for="upstream.recursor_port" 
                   class="block text-sm font-medium mb-2"
                   data-i18n="config.recursor.port">Recursor Port</label>
            <input type="number" 
                   id="upstream.recursor_port" 
                   name="upstream.recursor_port"
                   min="1024" 
                   max="65535"
                   class="w-full h-12 rounded-lg border border-border-light dark:border-border-dark bg-background-light dark:bg-black px-4 text-sm">
            <small data-i18n="config.recursor.portHelp">Default: 5353. Must be different from DNS listen port.</small>
        </div>

        <!-- çŠ¶æ€æ˜¾ç¤º -->
        <div class="form-group">
            <label class="block text-sm font-medium mb-2" data-i18n="config.recursor.status">Status</label>
            <div id="recursor-status" class="flex items-center gap-2 p-3 rounded-lg bg-background-light dark:bg-black border border-border-light dark:border-border-dark">
                <span id="recursor-status-indicator" class="w-3 h-3 rounded-full bg-gray-400"></span>
                <span id="recursor-status-text" data-i18n="config.recursor.statusUnknown">Unknown</span>
            </div>
        </div>

        <!-- ä¿¡æ¯é¢æ¿ -->
        <div class="form-group md:col-span-2 p-4 rounded-lg bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800">
            <h4 class="font-semibold mb-2 text-blue-900 dark:text-blue-100" data-i18n="config.recursor.info">Information</h4>
            <ul class="text-sm text-blue-800 dark:text-blue-200 space-y-1">
                <li data-i18n="config.recursor.infoVersion">â€¢ Version: Unbound 1.24.2</li>
                <li data-i18n="config.recursor.infoArch">â€¢ Architecture: x86-64 (Linux & Windows)</li>
                <li data-i18n="config.recursor.infoFeatures">â€¢ Features: DNSSEC validation, caching, prefetching</li>
                <li data-i18n="config.recursor.infoNote">â€¢ Note: Recursor runs as a separate process on localhost</li>
            </ul>
        </div>
    </div>
</section>
```

### 2.2 é›†æˆåˆ°é…ç½®é¡µé¢

**æ–‡ä»¶ï¼š** `webapi/web/components/config.html`

åœ¨ Upstream Card ä¹‹åæ·»åŠ ï¼š

```html
<!-- Recursor Card -->
<div id="recursor-config-container"></div>
```

### 2.3 åœ¨ index.html ä¸­å¼•å…¥æ–°æ¨¡å— âš ï¸ å…³é”®æ­¥éª¤

**æ–‡ä»¶ï¼š** `webapi/web/index.html`

ç”±äºé¡¹ç›®ä½¿ç”¨ä¼ ç»Ÿ `<script>` æ ‡ç­¾åŠ è½½ï¼ˆé Webpack/Viteï¼‰ï¼Œ**å¿…é¡»æ˜¾å¼å¼•å…¥æ–°æ¨¡å—**ã€‚

åœ¨ HTML åº•éƒ¨è„šæœ¬åŒºåŸŸï¼Œåœ¨ `js/modules/config.js` **ä¹‹å‰** æ·»åŠ ï¼š

```html
<!-- åœ¨ </body> å‰æ·»åŠ ï¼Œç¡®ä¿é¡ºåºæ­£ç¡® -->
<script src="js/modules/recursor.js"></script>
<script src="js/modules/config.js"></script>
```

**ä¸ºä»€ä¹ˆé¡ºåºå¾ˆé‡è¦ï¼š**
- `recursor.js` å®šä¹‰ `updateRecursorStatus()` å‡½æ•°
- `config.js` è°ƒç”¨ `updateRecursorStatus()`
- å¿…é¡»å…ˆåŠ è½½ `recursor.js`ï¼Œå¦åˆ™ `config.js` ä¼šæŠ¥é”™ï¼š`updateRecursorStatus is not defined`

### 2.4 æ›´æ–°é…ç½®åŠ è½½é€»è¾‘

**æ–‡ä»¶ï¼š** `webapi/web/js/modules/config.js`

åœ¨ `populateForm()` å‡½æ•°ä¸­æ·»åŠ ï¼š

```javascript
// Recursor é…ç½®
setChecked('upstream.enable_recursor', config.upstream.enable_recursor || false);
setValue('upstream.recursor_port', config.upstream.recursor_port || 5353);

// åˆå§‹åŒ– Recursor çŠ¶æ€
updateRecursorStatus();
```

åœ¨ `saveConfig()` å‡½æ•°ä¸­æ·»åŠ ï¼š

```javascript
upstream: {
    // ... ç°æœ‰å­—æ®µ ...
    enable_recursor: form.elements['upstream.enable_recursor'].checked,
    recursor_port: parseInt(form.elements['upstream.recursor_port'].value) || 5353,
}
```

### 2.5 æ–°å¢ Recursor ç®¡ç†æ¨¡å—

**æ–‡ä»¶ï¼š** `webapi/web/js/modules/recursor.js`

```javascript
// Recursor ç®¡ç†æ¨¡å—

const RECURSOR_API_URL = '/api/recursor';

/**
 * è·å– Recursor çŠ¶æ€
 */
async function getRecursorStatus() {
    try {
        const response = await fetch(`${RECURSOR_API_URL}/status`);
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }
        return await response.json();
    } catch (error) {
        console.error('[Recursor] Failed to get status:', error);
        return null;
    }
}

/**
 * æ›´æ–° UI ä¸­çš„ Recursor çŠ¶æ€æ˜¾ç¤º
 */
async function updateRecursorStatus() {
    const statusIndicator = document.getElementById('recursor-status-indicator');
    const statusText = document.getElementById('recursor-status-text');
    
    if (!statusIndicator || !statusText) {
        return;
    }

    const status = await getRecursorStatus();
    
    if (!status) {
        statusIndicator.className = 'w-3 h-3 rounded-full bg-gray-400';
        statusText.textContent = i18n.t('config.recursor.statusUnknown');
        return;
    }

    // æ ¹æ®çŠ¶æ€æ›´æ–°æŒ‡ç¤ºå™¨é¢œè‰²
    if (status.enabled) {
        statusIndicator.className = 'w-3 h-3 rounded-full bg-green-500';
        statusText.textContent = i18n.t('config.recursor.statusRunning', {
            port: status.port,
            uptime: formatUptime(status.uptime)
        });
    } else {
        statusIndicator.className = 'w-3 h-3 rounded-full bg-red-500';
        statusText.textContent = i18n.t('config.recursor.statusStopped');
    }
}

/**
 * æ ¼å¼åŒ–è¿è¡Œæ—¶é—´
 */
function formatUptime(seconds) {
    if (!seconds) return '0s';
    
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    
    if (hours > 0) {
        return `${hours}h ${minutes}m`;
    } else if (minutes > 0) {
        return `${minutes}m ${secs}s`;
    } else {
        return `${secs}s`;
    }
}

/**
 * å®šæœŸæ›´æ–° Recursor çŠ¶æ€ï¼ˆæ¯ 5 ç§’ï¼‰
 */
function startRecursorStatusPolling() {
    setInterval(updateRecursorStatus, 5000);
}

// é¡µé¢åŠ è½½æ—¶å¯åŠ¨è½®è¯¢
document.addEventListener('DOMContentLoaded', () => {
    startRecursorStatusPolling();
});

// è¯­è¨€å˜æ›´æ—¶æ›´æ–°çŠ¶æ€æ˜¾ç¤º
window.addEventListener('languageChanged', updateRecursorStatus);
```

---

## ğŸš¨ é‡è¦é£é™©æç¤º

### é»˜è®¤ç«¯å£ 5353 çš„é£é™©

**é—®é¢˜**ï¼š5353 æ˜¯ mDNS (Multicast DNS) çš„æ ‡å‡†ç«¯å£ã€‚

**é£é™©åœºæ™¯**ï¼š
- Windows/macOS ä¸Šå¦‚æœè¿è¡Œ Bonjour æˆ–å…¶ä»– mDNS æœåŠ¡
- é€šè¿‡ UDP ç»‘å®šæ­¤ç«¯å£å¯èƒ½ä¼šå†²çªæˆ–äº§ç”Ÿæ„å¤–è¡Œä¸º
- å¯èƒ½å¯¼è‡´ Recursor å¯åŠ¨å¤±è´¥æˆ– mDNS æœåŠ¡å¼‚å¸¸

**å»ºè®®æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆ A**ï¼šä¿®æ”¹é»˜è®¤ç«¯å£ï¼ˆæ¨èï¼‰
```go
// åœ¨ config/config_defaults.go ä¸­æ”¹ä¸º
if cfg.Upstream.RecursorPort == 0 {
    cfg.Upstream.RecursorPort = 8053  // æ”¹ä¸º 8053ï¼ˆæ›´å®‰å…¨ï¼‰
}
```

**æ–¹æ¡ˆ B**ï¼šåœ¨ UI ä¸­æ·»åŠ è­¦å‘Šæç¤º
```html
<small class="text-yellow-600 dark:text-yellow-400">
    âš ï¸ é¿å…ä½¿ç”¨ 5353 (mDNS æ ‡å‡†ç«¯å£)ã€‚å¦‚é‡ç«¯å£å†²çªï¼Œè¯·æ”¹ç”¨ 8053 æˆ–å…¶ä»–é«˜ç«¯å£ã€‚
</small>
```

**æ–¹æ¡ˆ C**ï¼šä¸¤è€…ç»“åˆï¼ˆæœ€ä½³ï¼‰
- é»˜è®¤ç«¯å£æ”¹ä¸º 8053
- UI ä¸­ä¿ç•™è­¦å‘Šæç¤º

---

## ğŸ”’ JavaScript ä½œç”¨åŸŸç®¡ç†

### å½“å‰è®¾è®¡

ç”±äºé¡¹ç›®ä½¿ç”¨ä¼ ç»Ÿ `<script>` æ ‡ç­¾åŠ è½½ï¼ˆéæ¨¡å—åŒ–ï¼‰ï¼Œæ‰€æœ‰å‡½æ•°éƒ½æš´éœ²åœ¨å…¨å±€ä½œç”¨åŸŸï¼š

```javascript
// recursor.js ä¸­çš„å…¨å±€å˜é‡å’Œå‡½æ•°
const RECURSOR_API_URL = '/api/recursor';
async function getRecursorStatus() { ... }
async function updateRecursorStatus() { ... }
function formatUptime(seconds) { ... }
function startRecursorStatusPolling() { ... }
```

### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡

- `config.js` éœ€è¦è°ƒç”¨ `updateRecursorStatus()`
- å¿…é¡»æš´éœ²åœ¨å…¨å±€ä½œç”¨åŸŸæ‰èƒ½è¢«å…¶ä»–æ¨¡å—è®¿é—®
- å½“å‰å‘½åå·²è¶³å¤Ÿç‹¬ç‰¹ï¼Œä¸ä¼šä¸å…¶ä»–å…¨å±€å˜é‡å†²çª

### æœªæ¥æ”¹è¿›æ–¹å‘

å¦‚æœé¡¹ç›®è¿ç§»åˆ°æ¨¡å—åŒ–ï¼ˆWebpack/Viteï¼‰ï¼Œå¯ä»¥æ”¹ä¸ºï¼š

```javascript
// ä½¿ç”¨ ES6 æ¨¡å—
export async function updateRecursorStatus() { ... }

// åœ¨ config.js ä¸­å¯¼å…¥
import { updateRecursorStatus } from './recursor.js';
```

---

### 3.1 æ–°å¢ API ç«¯ç‚¹

**æ–‡ä»¶ï¼š** `webapi/api_recursor.go`ï¼ˆæ–°å»ºï¼‰

```go
package webapi

import (
    "net/http"
    "smartdnssort/logger"
    "github.com/gin-gonic/gin"
)

// RecursorStatus é€’å½’è§£æå™¨çŠ¶æ€
type RecursorStatus struct {
    Enabled         bool   `json:"enabled"`
    Port            int    `json:"port"`
    Address         string `json:"address"`
    Uptime          int64  `json:"uptime"` // ç§’
    LastHealthCheck int64  `json:"last_health_check"`
}

// GetRecursorStatus è·å– Recursor çŠ¶æ€
func (api *API) GetRecursorStatus(c *gin.Context) {
    server := api.server
    
    if server.recursorMgr == nil {
        c.JSON(http.StatusOK, RecursorStatus{
            Enabled: false,
        })
        return
    }

    status := RecursorStatus{
        Enabled:         server.recursorMgr.IsEnabled(),
        Port:            server.recursorMgr.GetPort(),
        Address:         server.recursorMgr.GetAddress(),
        LastHealthCheck: server.recursorMgr.GetLastHealthCheck().Unix(),
    }

    // è®¡ç®—è¿è¡Œæ—¶é—´ï¼ˆå¦‚æœå¯ç”¨ï¼‰
    if status.Enabled {
        // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´è¯¦ç»†çš„è¿è¡Œæ—¶é—´è®¡ç®—
        status.Uptime = 0 // å¾…å®ç°
    }

    c.JSON(http.StatusOK, status)
}

// RegisterRecursorRoutes æ³¨å†Œ Recursor ç›¸å…³è·¯ç”±
func (api *API) RegisterRecursorRoutes(router *gin.Engine) {
    recursorGroup := router.Group("/api/recursor")
    {
        recursorGroup.GET("/status", api.GetRecursorStatus)
    }
}
```

### 3.2 åœ¨ API åˆå§‹åŒ–ä¸­æ³¨å†Œè·¯ç”±

**æ–‡ä»¶ï¼š** `webapi/api.go`

åœ¨ `NewAPI()` æˆ–è·¯ç”±æ³¨å†Œå‡½æ•°ä¸­æ·»åŠ ï¼š

```go
// æ³¨å†Œ Recursor è·¯ç”±
api.RegisterRecursorRoutes(router)
```

---

## 4ï¸âƒ£ å›½é™…åŒ– (i18n) é…ç½®

### 4.1 è‹±æ–‡ç¿»è¯‘

**æ–‡ä»¶ï¼š** `webapi/web/js/i18n/resources-en.js`

æ·»åŠ ï¼š

```javascript
config: {
    // ... ç°æœ‰é…ç½® ...
    recursor: {
        legend: "Recursive Resolver",
        enable: "Enable Embedded Unbound Recursor",
        enableHelp: "Provides recursive DNS resolution capability. Requires Unbound 1.24.2 binary.",
        port: "Recursor Port",
        portHelp: "Default: 5353. Must be different from DNS listen port.",
        status: "Status",
        statusUnknown: "Unknown",
        statusRunning: "Running on port {{port}} (Uptime: {{uptime}})",
        statusStopped: "Stopped",
        info: "Information",
        infoVersion: "Version: Unbound 1.24.2",
        infoArch: "Architecture: x86-64 (Linux & Windows)",
        infoFeatures: "Features: DNSSEC validation, caching, prefetching",
        infoNote: "Note: Recursor runs as a separate process on localhost",
    }
}
```

### 4.2 ä¸­æ–‡ç¿»è¯‘

**æ–‡ä»¶ï¼š** `webapi/web/js/i18n/resources-zh-cn.js`

æ·»åŠ ï¼š

```javascript
config: {
    // ... ç°æœ‰é…ç½® ...
    recursor: {
        legend: "é€’å½’è§£æå™¨",
        enable: "å¯ç”¨åµŒå…¥å¼ Unbound é€’å½’è§£æå™¨",
        enableHelp: "æä¾›é€’å½’ DNS è§£æåŠŸèƒ½ã€‚éœ€è¦ Unbound 1.24.2 äºŒè¿›åˆ¶æ–‡ä»¶ã€‚",
        port: "é€’å½’è§£æå™¨ç«¯å£",
        portHelp: "é»˜è®¤ï¼š5353ã€‚å¿…é¡»ä¸ DNS ç›‘å¬ç«¯å£ä¸åŒã€‚",
        status: "çŠ¶æ€",
        statusUnknown: "æœªçŸ¥",
        statusRunning: "è¿è¡Œä¸­ï¼ˆç«¯å£ï¼š{{port}}ï¼Œè¿è¡Œæ—¶é—´ï¼š{{uptime}}ï¼‰",
        statusStopped: "å·²åœæ­¢",
        info: "ä¿¡æ¯",
        infoVersion: "ç‰ˆæœ¬ï¼šUnbound 1.24.2",
        infoArch: "æ¶æ„ï¼šx86-64ï¼ˆLinux å’Œ Windowsï¼‰",
        infoFeatures: "åŠŸèƒ½ï¼šDNSSEC éªŒè¯ã€ç¼“å­˜ã€é¢„å–",
        infoNote: "æ³¨æ„ï¼šé€’å½’è§£æå™¨ä½œä¸ºç‹¬ç«‹è¿›ç¨‹è¿è¡Œåœ¨æœ¬åœ°ä¸»æœºä¸Š",
    }
}
```

---

## 5ï¸âƒ£ ç»„ä»¶åŠ è½½

### 5.1 æ›´æ–°ç»„ä»¶åŠ è½½å™¨

**æ–‡ä»¶ï¼š** `webapi/web/js/modules/component-loader.js`

åœ¨ç»„ä»¶åˆ—è¡¨ä¸­æ·»åŠ ï¼š

```javascript
const components = [
    // ... ç°æœ‰ç»„ä»¶ ...
    {
        id: 'recursor-config',
        file: 'components/config-recursor.html',
        container: 'recursor-config-container'
    }
];
```

---

## 6ï¸âƒ£ æœ¬åœ°æœåŠ¡å™¨æ•°æ®æ˜¾ç¤º

### 6.1 çŠ¶æ€æ˜¾ç¤ºæµç¨‹

```
ç”¨æˆ·æ‰“å¼€é…ç½®é¡µé¢
    â†“
åŠ è½½é…ç½®ï¼ˆåŒ…æ‹¬ enable_recursor å’Œ recursor_portï¼‰
    â†“
è°ƒç”¨ /api/recursor/status è·å–å®æ—¶çŠ¶æ€
    â†“
æ ¹æ®çŠ¶æ€æ›´æ–° UI æŒ‡ç¤ºå™¨
    â†“
æ¯ 5 ç§’è½®è¯¢ä¸€æ¬¡çŠ¶æ€
    â†“
ç”¨æˆ·ä¿®æ”¹é…ç½®å¹¶ä¿å­˜
    â†“
åç«¯é‡å¯ Recursorï¼ˆå¦‚æœé…ç½®æ”¹å˜ï¼‰
    â†“
å‰ç«¯è‡ªåŠ¨åˆ·æ–°çŠ¶æ€æ˜¾ç¤º
```

### 6.2 çŠ¶æ€æŒ‡ç¤ºå™¨è®¾è®¡

| çŠ¶æ€ | é¢œè‰² | æ˜¾ç¤ºæ–‡æœ¬ |
|------|------|---------|
| è¿è¡Œä¸­ | ğŸŸ¢ ç»¿è‰² | Running on port 5353 (Uptime: 2h 15m) |
| å·²åœæ­¢ | ğŸ”´ çº¢è‰² | Stopped |
| æœªçŸ¥ | âš« ç°è‰² | Unknown |

### 6.3 å®æ—¶æ›´æ–°æœºåˆ¶

```javascript
// æ¯ 5 ç§’è‡ªåŠ¨æ›´æ–°ä¸€æ¬¡
setInterval(async () => {
    const status = await fetch('/api/recursor/status').then(r => r.json());
    updateStatusUI(status);
}, 5000);
```

---

## 7ï¸âƒ£ ç”¨æˆ·äº¤äº’æµç¨‹

### 7.1 å¯ç”¨ Recursor

```
1. ç”¨æˆ·å‹¾é€‰ "Enable Embedded Unbound Recursor"
2. è¾“å…¥ç«¯å£å·ï¼ˆé»˜è®¤ 5353ï¼‰
3. ç‚¹å‡» "Save & Apply"
4. åç«¯ï¼š
   - éªŒè¯ç«¯å£ä¸ä¸ DNS ç«¯å£å†²çª
   - åˆå§‹åŒ– Recursor Manager
   - å¯åŠ¨ Unbound è¿›ç¨‹
5. å‰ç«¯ï¼š
   - æ˜¾ç¤ºåŠ è½½çŠ¶æ€
   - è½®è¯¢çŠ¶æ€ç›´åˆ° "Running"
   - æ˜¾ç¤ºæˆåŠŸæç¤º
```

### 7.2 ç¦ç”¨ Recursor

```
1. ç”¨æˆ·å–æ¶ˆå‹¾é€‰ "Enable Embedded Unbound Recursor"
2. ç‚¹å‡» "Save & Apply"
3. åç«¯ï¼š
   - åœæ­¢ Unbound è¿›ç¨‹
   - æ¸…ç†ä¸´æ—¶æ–‡ä»¶
4. å‰ç«¯ï¼š
   - çŠ¶æ€ç«‹å³å˜ä¸º "Stopped"
   - æ˜¾ç¤ºæˆåŠŸæç¤º
```

---

## 8ï¸âƒ£ é”™è¯¯å¤„ç†

### 8.1 å¸¸è§é”™è¯¯åœºæ™¯

| é”™è¯¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| ç«¯å£è¢«å ç”¨ | 5353 å·²è¢«å…¶ä»–è¿›ç¨‹ä½¿ç”¨ | ä¿®æ”¹ recursor_port æˆ–å…³é—­å ç”¨è¿›ç¨‹ |
| äºŒè¿›åˆ¶æ–‡ä»¶ç¼ºå¤± | Unbound äºŒè¿›åˆ¶æœªåµŒå…¥ | é‡æ–°ç¼–è¯‘é¡¹ç›® |
| æƒé™ä¸è¶³ | æ— æ³•ç»‘å®šä½ç«¯å£ | ä½¿ç”¨é«˜äº 1024 çš„ç«¯å£ |
| å¯åŠ¨è¶…æ—¶ | Unbound å¯åŠ¨ç¼“æ…¢ | å¢åŠ è¶…æ—¶æ—¶é—´æˆ–æ£€æŸ¥ç³»ç»Ÿèµ„æº |

### 8.2 å‰ç«¯é”™è¯¯æç¤º

```javascript
// åœ¨ recursor.js ä¸­æ·»åŠ é”™è¯¯å¤„ç†
async function updateRecursorStatus() {
    try {
        const status = await getRecursorStatus();
        // ... æ›´æ–° UI ...
    } catch (error) {
        console.error('[Recursor] Error:', error);
        statusText.textContent = i18n.t('config.recursor.statusError', {
            error: error.message
        });
        statusIndicator.className = 'w-3 h-3 rounded-full bg-yellow-500';
    }
}
```

---

## 9ï¸âƒ£ æ€»ç»“

### å‰ç«¯ä¿®æ”¹æ¸…å• âš ï¸ æŒ‰é¡ºåºæ‰§è¡Œ

- [ ] **[å…³é”®]** ä¿®æ”¹ `webapi/web/index.html` - åœ¨ config.js å‰å¼•å…¥ recursor.js
- [ ] åˆ›å»º `webapi/web/components/config-recursor.html` ç»„ä»¶
- [ ] æ›´æ–° `webapi/web/components/config.html` æ·»åŠ å®¹å™¨
- [ ] æ›´æ–° `webapi/web/js/modules/config.js` æ·»åŠ è¡¨å•å¤„ç†
- [ ] åˆ›å»º `webapi/web/js/modules/recursor.js` æ¨¡å—
- [ ] æ›´æ–° `webapi/web/js/modules/component-loader.js`
- [ ] æ·»åŠ è‹±æ–‡ç¿»è¯‘ `webapi/web/js/i18n/resources-en.js`
- [ ] æ·»åŠ ä¸­æ–‡ç¿»è¯‘ `webapi/web/js/i18n/resources-zh-cn.js`
- [ ] æµ‹è¯•çŠ¶æ€æ˜¾ç¤º
- [ ] æµ‹è¯•å¯ç”¨/ç¦ç”¨æµç¨‹
- [ ] æµ‹è¯•é”™è¯¯å¤„ç†

### åç«¯ä¿®æ”¹æ¸…å•

- [ ] åœ¨ `config/config_types.go` æ·»åŠ é…ç½®å­—æ®µ
- [ ] åœ¨ `config/config_defaults.go` æ·»åŠ é»˜è®¤å€¼ï¼ˆ**è€ƒè™‘æ”¹ä¸º 8053 é¿å… mDNS å†²çª**ï¼‰
- [ ] åˆ›å»º `webapi/api_recursor.go` API ç«¯ç‚¹
- [ ] åœ¨ `webapi/api.go` æ³¨å†Œè·¯ç”±
- [ ] åœ¨ `dnsserver/server.go` æ·»åŠ  recursorMgr å­—æ®µ
- [ ] åœ¨ `dnsserver/server_init.go` åˆå§‹åŒ– Manager
- [ ] åœ¨ `dnsserver/server_lifecycle.go` å¯åŠ¨/åœæ­¢ Manager

### é›†æˆæµ‹è¯•æ¸…å•

- [ ] å¯ç”¨ Recursor å¹¶éªŒè¯çŠ¶æ€
- [ ] ç¦ç”¨ Recursor å¹¶éªŒè¯çŠ¶æ€
- [ ] ä¿®æ”¹ç«¯å£å¹¶éªŒè¯
- [ ] æµ‹è¯•ç«¯å£å†²çªæ£€æŸ¥
- [ ] æµ‹è¯•å¤šè¯­è¨€æ˜¾ç¤º
- [ ] æµ‹è¯•é”™è¯¯å¤„ç†
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆå†…å­˜ã€CPUï¼‰
- [ ] æµ‹è¯• mDNS ç«¯å£å†²çªï¼ˆå¦‚æœä½¿ç”¨ 5353ï¼‰

---

## ğŸ”Ÿ å‚è€ƒèµ„æº

- Recursor å¼€å‘æŒ‡å—ï¼š`recursor/DEVELOPMENT_GUIDE.md`
- Manager å®ç°ï¼š`recursor/manager.go`
- ç°æœ‰é…ç½® UIï¼š`webapi/web/components/config-upstream.html`
- i18n ç³»ç»Ÿï¼š`webapi/web/js/i18n/`
